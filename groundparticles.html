
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1.6.2. Simulations based on Monte Carlo EAS ground particle data &mdash; SAPPHiRE 0.9 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="SAPPHiRE 0.9 documentation" href="index.html" />
    <link rel="up" title="1.6. Performing simulations" href="simulations.html" />
    <link rel="next" title="1.6.3. Simulations based on theoretical models of EAS lateral distributions" href="ldf.html" />
    <link rel="prev" title="1.6.1. Simulation base classes" href="base.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ldf.html" title="1.6.3. Simulations based on theoretical models of EAS lateral distributions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="base.html" title="1.6.1. Simulation base classes"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">SAPPHiRE 0.9 documentation</a> &raquo;</li>
          <li><a href="sapphire.html" >1. SAPPHiRE</a> &raquo;</li>
          <li><a href="simulations.html" accesskey="U">1.6. Performing simulations</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-sapphire.simulations.groundparticles">
<span id="simulations-based-on-monte-carlo-eas-ground-particle-data"></span><h1>1.6.2. Simulations based on Monte Carlo EAS ground particle data<a class="headerlink" href="#module-sapphire.simulations.groundparticles" title="Permalink to this headline">¶</a></h1>
<p>Simulation classes</p>
<p>Define simulations as a class, so they can be subclassed.  This way,
only bits of simulation logic need to be overridden.</p>
<dl class="class">
<dt id="sapphire.simulations.groundparticles.GroundParticlesSimulation">
<em class="property">class </em><tt class="descclassname">sapphire.simulations.groundparticles.</tt><tt class="descname">GroundParticlesSimulation</tt><big>(</big><em>cluster</em>, <em>data</em>, <em>grdpcles</em>, <em>output</em>, <em>R</em>, <em>N</em>, <em>force=False</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#sapphire.simulations.groundparticles.GroundParticlesSimulation" title="Permalink to this definition">¶</a></dt>
<dd><p>Simulation based on a groundparticles table</p>
<p>This class defines a detector simulation, taking a shower simulation
as input.  This class can be overridden to, for example, parallelize
the simulation.</p>
<dl class="method">
<dt id="sapphire.simulations.groundparticles.GroundParticlesSimulation.generate_positions">
<tt class="descname">generate_positions</tt><big>(</big><big>)</big><a class="headerlink" href="#sapphire.simulations.groundparticles.GroundParticlesSimulation.generate_positions" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate positions and an orientation uniformly on a circle</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">r, phi, alpha</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="sapphire.simulations.groundparticles.GroundParticlesSimulation.get_detector_particles">
<tt class="descname">get_detector_particles</tt><big>(</big><em>detector</em><big>)</big><a class="headerlink" href="#sapphire.simulations.groundparticles.GroundParticlesSimulation.get_detector_particles" title="Permalink to this definition">¶</a></dt>
<dd><p>Return all particles hitting a single detector</p>
<p>Given a HDF5 table containing information on all simulated particles
and coordinates and orientation of a detector, search for all
particles which have hit the detector.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>detector</strong> &#8211; Detector instance</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of particles which have hit the detector</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="sapphire.simulations.groundparticles.GroundParticlesSimulation.get_line_boundary_eqs">
<tt class="descname">get_line_boundary_eqs</tt><big>(</big><em>p0</em>, <em>p1</em>, <em>p2</em><big>)</big><a class="headerlink" href="#sapphire.simulations.groundparticles.GroundParticlesSimulation.get_line_boundary_eqs" title="Permalink to this definition">¶</a></dt>
<dd><p>Get line equations using three points</p>
<p>Given three points, this function computes the equations for two
parallel lines going through these points.  The first and second point
are on the same line, whereas the third point is taken to be on a
line which runs parallel to the first.  The return value is an
equation and two boundaries which can be used to test if a point is
between the two lines.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>p1</strong> (<em>p0,</em>) &#8211; (x, y) tuples on the same line</li>
<li><strong>p2</strong> &#8211; (x, y) tuple on the parallel line</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">value1, equation, value2, such that points satisfying value1
&lt; equation &lt; value2 are between the parallel lines</p>
</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">get_line_boundary_eqs</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="go">(0.0, &#39;y - 1.000000 * x&#39;, 2.0)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sapphire.simulations.groundparticles.GroundParticlesSimulation.get_station_particles">
<tt class="descname">get_station_particles</tt><big>(</big><em>station</em><big>)</big><a class="headerlink" href="#sapphire.simulations.groundparticles.GroundParticlesSimulation.get_station_particles" title="Permalink to this definition">¶</a></dt>
<dd><p>Return all particles hitting a station</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>station</strong> &#8211; station definition</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of detectors containing list of particles</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">list of lists</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="sapphire.simulations.groundparticles.GroundParticlesSimulation.run">
<tt class="descname">run</tt><big>(</big><em>positions=None</em><big>)</big><a class="headerlink" href="#sapphire.simulations.groundparticles.GroundParticlesSimulation.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a simulation</p>
<p>This is the code which performs the simulation.  It creates a list
of positions, creates all necessary tables and performs the
simulation.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>positions</strong> &#8211; if given, use these coordinates instead of
generating new ones</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="sapphire.simulations.groundparticles.GroundParticlesSimulation.simulate_event">
<tt class="descname">simulate_event</tt><big>(</big><em>event_id</em>, <em>r</em>, <em>phi</em>, <em>alpha</em><big>)</big><a class="headerlink" href="#sapphire.simulations.groundparticles.GroundParticlesSimulation.simulate_event" title="Permalink to this definition">¶</a></dt>
<dd><p>Simulate a single event</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>event_id</strong> &#8211; event id</li>
<li><strong>phi</strong> (<em>r,</em>) &#8211; polar coordinates of cluster center</li>
<li><strong>alpha</strong> &#8211; rotation of cluster</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="sapphire.simulations.groundparticles.GroundParticlesSimulation.store_observables">
<tt class="descname">store_observables</tt><big>(</big><big>)</big><a class="headerlink" href="#sapphire.simulations.groundparticles.GroundParticlesSimulation.store_observables" title="Permalink to this definition">¶</a></dt>
<dd><p>Analyze simulation results and store derived data</p>
<p>Loop through simulation result tables and find observables like the
number of particles which hit detectors, as well as the arrival time
of the first particle to hit a detector.  The number of detectors
which have particles are also recorded.  Finally the per shower
results from all stations are combined and stored as a coincidence
event.</p>
<p>To speed things up, pointers into the two simulation result tables are
advanced row by row.  Event and station id&#8217;s are continually checked
to now when to break.  The flow is a bit complicated, but it is fast.</p>
</dd></dl>

<dl class="method">
<dt id="sapphire.simulations.groundparticles.GroundParticlesSimulation.write_coincidence">
<tt class="descname">write_coincidence</tt><big>(</big><em>event</em>, <em>N</em><big>)</big><a class="headerlink" href="#sapphire.simulations.groundparticles.GroundParticlesSimulation.write_coincidence" title="Permalink to this definition">¶</a></dt>
<dd><p>Transform coordinates before calling super</p>
<p>Until now, the simulation has set new cluster coordinates for each
event.  Using that, it has sampled a static shower by using many cluster
positions and rotations.  This is equivalent to simulation a static
cluster by using many shower core positions and rotations.</p>
<p>This change of coordinates will transform the cluster center coordinate
(relative to the shower core) to the shower core coordinate (relative to
the cluster center), and stores it in the range [-pi, pi).</p>
<p>The shower azimuthal angle is always zero in the simulation.  If the
cluster is rotated over an angle alpha, the observed azimuthal angle is
-alpha.</p>
</dd></dl>

<dl class="method">
<dt id="sapphire.simulations.groundparticles.GroundParticlesSimulation.write_detector_particles">
<tt class="descname">write_detector_particles</tt><big>(</big><em>event_id</em>, <em>station_id</em>, <em>plist</em><big>)</big><a class="headerlink" href="#sapphire.simulations.groundparticles.GroundParticlesSimulation.write_detector_particles" title="Permalink to this definition">¶</a></dt>
<dd><p>Write particles to file</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>event_id</strong> &#8211; simulation event id</li>
<li><strong>station_id</strong> &#8211; station id inside cluster</li>
<li><strong>plist</strong> &#8211; list of detectors, containing list of particles</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="sapphire.simulations.groundparticles.GroundParticlesSimulation.write_header">
<tt class="descname">write_header</tt><big>(</big><em>event_id</em>, <em>station_id</em>, <em>r</em>, <em>phi</em>, <em>alpha</em><big>)</big><a class="headerlink" href="#sapphire.simulations.groundparticles.GroundParticlesSimulation.write_header" title="Permalink to this definition">¶</a></dt>
<dd><p>Write simulation event header information to file</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>event_id</strong> &#8211; simulation event id</li>
<li><strong>station_id</strong> &#8211; station id inside cluster, 0 for cluster header</li>
<li><strong>phi</strong> (<em>r,</em>) &#8211; r, phi for cluster or station position, both as
absolute coordinates</li>
<li><strong>alpha</strong> &#8211; cluster rotation angle or station rotation angle</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="sapphire.simulations.groundparticles.GroundParticlesSimulation.write_observables">
<tt class="descname">write_observables</tt><big>(</big><em>observables</em>, <em>num_particles</em>, <em>timings</em><big>)</big><a class="headerlink" href="#sapphire.simulations.groundparticles.GroundParticlesSimulation.write_observables" title="Permalink to this definition">¶</a></dt>
<dd><p>Transform coordinates before calling super</p>
<p>Until now, the simulation has set new cluster coordinates for each
event.  Using that, it has sampled a static shower by using many cluster
positions and rotations.  This is equivalent to simulation a static
cluster by using many shower core positions and rotations.</p>
<p>Now, we will transform to the coordinate system of the cluster.  We make
the simple assumption that the transformation from cluster coordinates
to shower coordinates and back again will simply result in cluster
coordinates.  Thus:</p>
<div class="math">
\[T^{-1}(T(x, y)) = (x, y).\]</div>
<p>In this method, we will simply lookup the station coordinates in the
cluster coordinate system.</p>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="base.html"
                        title="previous chapter">1.6.1. Simulation base classes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ldf.html"
                        title="next chapter">1.6.3. Simulations based on theoretical models of EAS lateral distributions</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/groundparticles.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ldf.html" title="1.6.3. Simulations based on theoretical models of EAS lateral distributions"
             >next</a> |</li>
        <li class="right" >
          <a href="base.html" title="1.6.1. Simulation base classes"
             >previous</a> |</li>
        <li><a href="index.html">SAPPHiRE 0.9 documentation</a> &raquo;</li>
          <li><a href="sapphire.html" >1. SAPPHiRE</a> &raquo;</li>
          <li><a href="simulations.html" >1.6. Performing simulations</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, David Fokkema.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>