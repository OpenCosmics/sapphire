
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2. Tutorial &mdash; SAPPHiRE 0.9 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="SAPPHiRE 0.9 documentation" href="index.html" />
    <link rel="next" title="3. SAPPHiRE Reference" href="sapphire.html" />
    <link rel="prev" title="1. Installation" href="installation.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="sapphire.html" title="3. SAPPHiRE Reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="1. Installation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">SAPPHiRE 0.9 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tutorial">
<h1>2. Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>SAPPHiRE simplifies data access, simulations and analysis for the <a class="reference external" href="http://www.hisparc.nl">HiSPARC</a> experiment.  In this tutorial, we&#8217;ll try to give
you a feeling for the things you can <em>do</em> with SAPPHiRE.  How can you
download data?  How can you analyze this data?  How can you produce
pulseheight histograms?  How can you calculate the direction of cosmic
rays?  This tutorial will only give you an overview of what&#8217;s possible
with SAPPHiRE.  For details on all available classes and methods, please
see the <a class="reference internal" href="sapphire.html"><em>SAPPHiRE Reference</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We&#8217;ll require you to know some basic Python.  If not, you can look at
the official <a class="reference external" href="http://docs.python.org/2/tutorial/">Python tutorial</a>.
If you know how to start a Python interpreter, you can probably start
best with chapter 3 and ignore chapter 2.  Chapters 3 through 6 should
give you some working knowledge of Python.</p>
</div>
<div class="section" id="first-steps">
<h2>2.1. First steps<a class="headerlink" href="#first-steps" title="Permalink to this headline">¶</a></h2>
<p>In a few examples, we will plot the data which we have produced.  We make
use of pylab, which is included with matplotlib.  In OS X and Linux, you
can start an IPython terminal with pylab using:</p>
<div class="highlight-python"><pre>$ ipython --pylab</pre>
</div>
<p>On Windows, where you&#8217;re probably using Python(x,y), this should be the
default mode.</p>
<p>Whenever you see something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&#39;Hello, world&#39;</span>
<span class="go">Hello, world</span>
</pre></div>
</div>
<p>it means we&#8217;re typing in Python code.  The <tt class="docutils literal"><span class="pre">&gt;&gt;&gt;</span></tt> is the Python <em>prompt</em>.
It tells you that the Python interpreter is waiting for you to give it
some instructions.  In the above example, we&#8217;ve typed in <tt class="docutils literal"><span class="pre">print</span> <span class="pre">'Hello,</span>
<span class="pre">world'</span></tt>.  The interpreter subsequently executed the code and printed
<em>Hello, world</em> on the screen.  Some further examples (try them, if you
like!):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">3</span> <span class="o">*</span> <span class="n">a</span>
<span class="go">12</span>
</pre></div>
</div>
<p>The first thing we&#8217;ll have to do to start using SAPPHiRE is to <em>import</em>
the SAPPHiRE module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sapphire</span>
</pre></div>
</div>
<p>There will be no output if everything is succesful.  It is easy to get
some help from inside the Python terminal.  Just say:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">help</span><span class="p">(</span><span class="n">sapphire</span><span class="p">)</span>
</pre></div>
</div>
<p>and you&#8217;ll be presented with a basic help screen.  Instead of
<tt class="docutils literal"><span class="pre">sapphire</span></tt>, you can throw in modules, packages, functions, classes,
objects, etc.  Everything in Python has <em>some</em> help text associated with
it.  Not all of it is very helpful to a newcomer, hence this tutorial.
All help text is also available in the <a class="reference internal" href="sapphire.html"><em>SAPPHiRE Reference</em></a>.</p>
</div>
<div class="section" id="downloading-and-accessing-hisparc-data">
<h2>2.2. Downloading and accessing HiSPARC data<a class="headerlink" href="#downloading-and-accessing-hisparc-data" title="Permalink to this headline">¶</a></h2>
<p>The SAPPHiRE package comprises multiple modules and packages.  To access
data from the public database, we&#8217;ll have to import the <tt class="docutils literal"><span class="pre">publicdb</span></tt>
module.  Also, we need the <tt class="docutils literal"><span class="pre">tables</span></tt> module to actually store the data.
<a class="reference external" href="pytables.org">PyTables</a> is based on the open HDF5 data format, which is
used by <a class="reference external" href="http://www.hdfgroup.org/HDF5/users5.html">many (research) institutes</a>.  For example, it is used by
the KNMI and by NASA.  To specify the date and time for which to download
the data, we need the <tt class="docutils literal"><span class="pre">datetime</span></tt> module.  Thus, we have:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tables</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sapphire.publicdb</span>
</pre></div>
</div>
<p>Creating an empty data file, with the name <tt class="docutils literal"><span class="pre">mydata.h5</span></tt>, is done easily:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">openFile</span><span class="p">(</span><span class="s">&#39;mydata.h5&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">'w'</span></tt> means <em>write</em>, which creates a file for writing (and reading).
Mind that this will create an empty file.  If there already was a file
with that name, it will be overwritten!  Alternatively, you can say
<tt class="docutils literal"><span class="pre">'a'</span></tt>, which means <em>append</em>, thus adding to an existing file without
overwriting its contents.  Finally, you can specify <tt class="docutils literal"><span class="pre">'r'</span></tt> for
<em>read-only</em>.</p>
<div class="section" id="downloading-data">
<h3>2.2.1. Downloading data<a class="headerlink" href="#downloading-data" title="Permalink to this headline">¶</a></h3>
<p>To download data, we have to specify the date/time <em>range</em>.  If we want to
download data from the December 1, 2012 all through December 2, 2012,
we can specify this by typing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Mind that if we do not specify the hour of day, it is taken to be 00:00
hours.  Thus, there is no data included from December 3.  Alternatively,
we can download data from a two hour interval on October 17 by specifying
the hour of day:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
</pre></div>
</div>
<p>which is from 19:00 to 21:00 hours.  It is important to realize that the
we use a GPS clock, which equal to UTC (up to leap seconds).  So, if we
download data for a station in the Netherlands, we have just said from
20:00 to 22:00 local time.  You can specify the time up to the seconds.</p>
<p>We have not actually done anything yet.  We have just stored our time
window in two arbitrarily-named variables, <tt class="docutils literal"><span class="pre">start</span></tt> and <tt class="docutils literal"><span class="pre">end</span></tt>.  To
download data from station 501 and store it in a group with name <tt class="docutils literal"><span class="pre">/s501</span></tt>,
we can use the <a class="reference internal" href="publicdb.html#sapphire.publicdb.download_data" title="sapphire.publicdb.download_data"><tt class="xref py py-func docutils literal"><span class="pre">sapphire.publicdb.download_data()</span></tt></a> function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">sapphire</span><span class="o">.</span><span class="n">publicdb</span><span class="o">.</span><span class="n">download_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&#39;/s501&#39;</span><span class="p">,</span> <span class="mi">501</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
<span class="go">INFO:hisparc.publicdb:2012-12-01 00:00:00 None</span>
<span class="go">INFO:hisparc.publicdb:Getting server data URL (2012-12-01 00:00:00)</span>
<span class="go">INFO:hisparc.publicdb:Downloading data...</span>
<span class="go">INFO:hisparc.publicdb:Storing data...</span>
<span class="go">INFO:hisparc.publicdb:Done.</span>
<span class="go">INFO:hisparc.publicdb:2012-12-02 00:00:00 None</span>
<span class="go">INFO:hisparc.publicdb:Getting server data URL (2012-12-02 00:00:00)</span>
<span class="go">INFO:hisparc.publicdb:Downloading data...</span>
<span class="go">INFO:hisparc.publicdb:Storing data...</span>
<span class="go">INFO:hisparc.publicdb:Done.</span>
</pre></div>
</div>
<p>As you can see in the reference documentation of
<a class="reference internal" href="publicdb.html#sapphire.publicdb.download_data" title="sapphire.publicdb.download_data"><tt class="xref py py-func docutils literal"><span class="pre">sapphire.publicdb.download_data()</span></tt></a>, available by either clicking on
the link or typing in <tt class="docutils literal"><span class="pre">help(sapphire.publicdb.download_data)</span></tt> in the
interpreter, the function takes six arguments: <em>file, group, station_id,
start, end</em> and <em>get_blobs</em>.  The last one has the default argument
<em>False</em>, and may be omitted, as we have done here.  In our example, we
have opened a file, <tt class="docutils literal"><span class="pre">mydata.h5</span></tt>, and have stored the file <em>handler</em> in
the variable <tt class="docutils literal"><span class="pre">data</span></tt>.  So, we passed <tt class="docutils literal"><span class="pre">data</span></tt> to the function.  The group
name is <tt class="docutils literal"><span class="pre">/s501</span></tt>.  Group names in PyTables are just like folders in a
directory hierarchy.  So, we might have specified
<tt class="docutils literal"><span class="pre">/path/to/my/hisparc/data/files/for_station/s501</span></tt>.  It is important to
note that this has absolutely nothing to do with <em>files</em>.  Whatever path
you specify, it is all contained <em>inside</em> your data file.  Since this is
just a small data file, we have opted for a simple structure.  At the
moment, just one group named <tt class="docutils literal"><span class="pre">s501</span></tt> at the root of the hierarchy.  Group
names must start with a letter, hence the <tt class="docutils literal"><span class="pre">s</span></tt> for station.</p>
<p>The <em>station_id</em> is simply the station number.  Here, we&#8217;ve chosen to
download data for station 501, located at Nikhef.  The <em>start</em> and <em>end</em>
parameters specify the date/time range.  Finally, <em>get_blobs</em> selects
whether binary data should be downloaded.  This includes the traces of
individual events, error messages, etc.  We&#8217;ve selected the default, which
is <em>False</em>.  Binary data is often not neccessary, and will increase the
data size tenfold.</p>
</div>
<div class="section" id="looking-around">
<h3>2.2.2. Looking around<a class="headerlink" href="#looking-around" title="Permalink to this headline">¶</a></h3>
<p>If you want to know what groups and tables are contained within the data
file, just <tt class="docutils literal"><span class="pre">print</span></tt> it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">data</span>
<span class="go">mydata.h5 (File) &#39;&#39;</span>
<span class="go">Last modif.: &#39;Sat Dec 29 14:50:55 2012&#39;</span>
<span class="go">Object Tree:</span>
<span class="go">/ (RootGroup) &#39;&#39;</span>
<span class="go">/s501 (Group) &#39;Data group&#39;</span>
<span class="go">/s501/events (Table(137600,)) &#39;HiSPARC coincidences table&#39;</span>
<span class="go">/s501/weather (Table(51513,)) &#39;HiSPARC weather data&#39;</span>
</pre></div>
</div>
<p>The <em>object tree</em> gives an overview of all groups and tables.  As you can
see, the <tt class="docutils literal"><span class="pre">/s501</span></tt> group contains two tables, <tt class="docutils literal"><span class="pre">events</span></tt> and <tt class="docutils literal"><span class="pre">weather</span></tt>.
The events table contains the data from the HiSPARC scintillators, while
the weather table contains data from the (optional) weather station.</p>
<p>To directly access any object in the hierarchy, you can make use of the
<tt class="docutils literal"><span class="pre">data.root</span></tt> object, which points to the root group.  Then, just specify
the remaining path, with dots instead of slashes.  For example, to access
the events table:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">s501</span><span class="o">.</span><span class="n">events</span>
<span class="go">/s501/events (Table(137600,)) &#39;HiSPARC coincidences table&#39;</span>
</pre></div>
</div>
<p>Of course, we&#8217;d like to get some more information.  You can drop the print
statement, and just access the object directly.  PyTables is set up such
that it will give more detailed information whenever you specify the
object directly:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">s501</span><span class="o">.</span><span class="n">events</span>
<span class="go">/s501/events (Table(137600,)) &#39;HiSPARC coincidences table&#39;</span>
<span class="go">  description := {</span>
<span class="go">  &quot;event_id&quot;: UInt32Col(shape=(), dflt=0, pos=0),</span>
<span class="go">  &quot;timestamp&quot;: Time32Col(shape=(), dflt=0, pos=1),</span>
<span class="go">  &quot;nanoseconds&quot;: UInt32Col(shape=(), dflt=0, pos=2),</span>
<span class="go">  &quot;ext_timestamp&quot;: UInt64Col(shape=(), dflt=0, pos=3),</span>
<span class="go">  &quot;data_reduction&quot;: BoolCol(shape=(), dflt=False, pos=4),</span>
<span class="go">  &quot;trigger_pattern&quot;: UInt32Col(shape=(), dflt=0, pos=5),</span>
<span class="go">  &quot;baseline&quot;: Int16Col(shape=(4,), dflt=-1, pos=6),</span>
<span class="go">  &quot;std_dev&quot;: Int16Col(shape=(4,), dflt=-1, pos=7),</span>
<span class="go">  &quot;n_peaks&quot;: Int16Col(shape=(4,), dflt=-1, pos=8),</span>
<span class="go">  &quot;pulseheights&quot;: Int16Col(shape=(4,), dflt=-1, pos=9),</span>
<span class="go">  &quot;integrals&quot;: Int32Col(shape=(4,), dflt=-1, pos=10),</span>
<span class="go">  &quot;traces&quot;: Int32Col(shape=(4,), dflt=-1, pos=11),</span>
<span class="go">  &quot;event_rate&quot;: Float32Col(shape=(), dflt=0.0, pos=12)}</span>
<span class="go">  byteorder := &#39;little&#39;</span>
<span class="go">  chunkshape := (704,)</span>
</pre></div>
</div>
<p>There you go!  But what does it all <em>mean</em>?  Well, if you want to get to
the bottom of it, read the <a class="reference external" href="http://pytables.github.com/usersguide/index.html">PyTables documentation</a>.  We&#8217;ll give a quick
overview here.</p>
<p>First, this table contains 137600 rows.  In total, there are thirteen
columns: <tt class="docutils literal"><span class="pre">event_id</span></tt>, <tt class="docutils literal"><span class="pre">timestamp</span></tt>, <tt class="docutils literal"><span class="pre">nanoseconds</span></tt>, <tt class="docutils literal"><span class="pre">ext_timestamp</span></tt>,
<tt class="docutils literal"><span class="pre">data_reduction</span></tt>, <tt class="docutils literal"><span class="pre">trigger_pattern</span></tt>, <tt class="docutils literal"><span class="pre">baseline</span></tt>, <tt class="docutils literal"><span class="pre">std_dev</span></tt>,
<tt class="docutils literal"><span class="pre">n_peaks</span></tt>, <tt class="docutils literal"><span class="pre">pulseheights</span></tt>, <tt class="docutils literal"><span class="pre">integrals</span></tt>, <tt class="docutils literal"><span class="pre">traces</span></tt> and
<tt class="docutils literal"><span class="pre">event_rate</span></tt>.</p>
<p>Each event has a unique <a class="footnote-reference" href="#event-id" id="id1">[1]</a> identifier, <tt class="docutils literal"><span class="pre">event_id</span></tt>.  Each event
has a Unix timestamp in GPS time, <em>not</em> UTC.  A <a class="reference external" href="http://en.wikipedia.org/wiki/Unix_time">Unix timestamp</a> is the number of seconds that
have passed since January 1, 1970.  The sub-second part of the timestamp
is given in <tt class="docutils literal"><span class="pre">nanoseconds</span></tt>.  The <tt class="docutils literal"><span class="pre">ext_timestamp</span></tt> is the full timestamp
in ns.  Since there cannot exist another event with the same timestamp,
this field in combination with the station number uniquely identifies the
event.  The <tt class="docutils literal"><span class="pre">data_reduction</span></tt> flag signifies whether the full PMT trace
(<em>no</em> reduction) has been stored, or just the PMT pulse (<em>reduced</em>, or
<em>zero suppression</em>).  The <tt class="docutils literal"><span class="pre">trigger_pattern</span></tt> is a binary value containing
the exact trigger condition at the time of the event.  The <tt class="docutils literal"><span class="pre">baseline</span></tt>,
<tt class="docutils literal"><span class="pre">std_dev</span></tt>, <tt class="docutils literal"><span class="pre">n_peaks</span></tt>, <tt class="docutils literal"><span class="pre">pulseheights</span></tt> and <tt class="docutils literal"><span class="pre">integrals</span></tt> fields are
values derived from the PMT traces.  Each field contains four values, one
for each detector.  If a station only has two detectors, the last two
values for each field are -1.  If the baseline cannot be determined, all
these values are -999.  The <tt class="docutils literal"><span class="pre">event_rate</span></tt> is the trigger rate at the time
of the event.</p>
<p>We&#8217;ll get to work with this data in a moment.  First, we&#8217;ll take a look at
the weather table:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">s501</span><span class="o">.</span><span class="n">weather</span>
<span class="go">/s501/weather (Table(51513,)) &#39;HiSPARC weather data&#39;</span>
<span class="go">  description := {</span>
<span class="go">  &quot;event_id&quot;: UInt32Col(shape=(), dflt=0, pos=0),</span>
<span class="go">  &quot;timestamp&quot;: Time32Col(shape=(), dflt=0, pos=1),</span>
<span class="go">  &quot;temp_inside&quot;: Float32Col(shape=(), dflt=0.0, pos=2),</span>
<span class="go">  &quot;temp_outside&quot;: Float32Col(shape=(), dflt=0.0, pos=3),</span>
<span class="go">  &quot;humidity_inside&quot;: Int16Col(shape=(), dflt=0, pos=4),</span>
<span class="go">  &quot;humidity_outside&quot;: Int16Col(shape=(), dflt=0, pos=5),</span>
<span class="go">  &quot;barometer&quot;: Float32Col(shape=(), dflt=0.0, pos=6),</span>
<span class="go">  &quot;wind_dir&quot;: Int16Col(shape=(), dflt=0, pos=7),</span>
<span class="go">  &quot;wind_speed&quot;: Int16Col(shape=(), dflt=0, pos=8),</span>
<span class="go">  &quot;solar_rad&quot;: Int16Col(shape=(), dflt=0, pos=9),</span>
<span class="go">  &quot;uv&quot;: Int16Col(shape=(), dflt=0, pos=10),</span>
<span class="go">  &quot;evapotranspiration&quot;: Float32Col(shape=(), dflt=0.0, pos=11),</span>
<span class="go">  &quot;rain_rate&quot;: Float32Col(shape=(), dflt=0.0, pos=12),</span>
<span class="go">  &quot;heat_index&quot;: Int16Col(shape=(), dflt=0, pos=13),</span>
<span class="go">  &quot;dew_point&quot;: Float32Col(shape=(), dflt=0.0, pos=14),</span>
<span class="go">  &quot;wind_chill&quot;: Float32Col(shape=(), dflt=0.0, pos=15)}</span>
<span class="go">  byteorder := &#39;little&#39;</span>
<span class="go">  chunkshape := (1310,)</span>
</pre></div>
</div>
<p>We&#8217;ll let these column names speak for themselves.</p>
</div>
<div class="section" id="accessing-the-data">
<h3>2.2.3. Accessing the data<a class="headerlink" href="#accessing-the-data" title="Permalink to this headline">¶</a></h3>
<p>We can access the data in several ways.  We can address the complete
table, or just one or several rows from it.  We can read out a single
column, or select data based on a query.  Before we do any of that, we&#8217;ll
save us some typing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">events</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">s501</span><span class="o">.</span><span class="n">events</span>
</pre></div>
</div>
<p>Now, we have stored a short-hand reference to the events table. Let&#8217;s get
the first event:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">(1L, 1354320004, 670634817L, 1354320004670634817L, True, 196608L,</span>
<span class="go">[195, 197, 197, 197], [658, 763, 646, 771], [1, 0, 1, 0], [173, 3,</span>
<span class="go">407, 3], [1603, 0, 4019, 0], [0, 1, 2, 3], 0.9111111164093018)</span>
</pre></div>
</div>
<p>That&#8217;s the first event!  It is not, however, immediately clear what
numbers correspond to which columns.  They are in order, however, so you
could find out.  It is often easier to specify the column you&#8217;re
interested in:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;pulseheights&#39;</span><span class="p">]</span>
<span class="go">array([173,   3, 407,   3], dtype=int16)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;n_peaks&#39;</span><span class="p">]</span>
<span class="go">array([1, 0, 1, 0], dtype=int16)</span>
</pre></div>
</div>
<p>Which gives us the pulseheights of the first event.  The pulseheights are
16-bit integers (that&#8217;s the <tt class="docutils literal"><span class="pre">dtype=int16</span></tt>) and are determined after
digitizing the events using an analog-digital converter (ADC).  Each unit
corresponds to about -0.57 mV.  You can tell that the first and third
detectors had relatively large pulseheights, and that they were registered
as a significant <em>peak</em> in the signal (see the <tt class="docutils literal"><span class="pre">n_peaks</span></tt> column).</p>
<p>If you&#8217;re interested in the pulseheights of <em>all</em> events, the fastest way
to do it is to make use of the <tt class="xref py py-meth docutils literal"><span class="pre">Table.col()</span></tt>  method of the table:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">events</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s">&#39;pulseheights&#39;</span><span class="p">)</span>
<span class="go">array([[173,   3, 407,   3],</span>
<span class="go">       [  1,   2, 313, 756],</span>
<span class="go">       [211,   2,   2, 268],</span>
<span class="go">       ...,</span>
<span class="go">       [  2,   2, 529, 327],</span>
<span class="go">       [  7,   2, 318, 249],</span>
<span class="go">       [  3, 250,  14, 416]], dtype=int16)</span>
</pre></div>
</div>
<p>It is also possible to select the data based on a query.  For example, to
select all events between timestamps 1354320000 and 1354323600 (a one-hour
time span):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t0</span> <span class="o">=</span> <span class="mi">1354320000</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="o">=</span> <span class="n">t0</span> <span class="o">+</span> <span class="mi">3600</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sel_events</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">readWhere</span><span class="p">(</span><span class="s">&#39;(t0 &lt;= timestamp) &amp; (timestamp &lt; t1)&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">sel_events</span><span class="p">)</span>
<span class="go">2836</span>
</pre></div>
</div>
<p>Thus, we have selected 2836 events.  The variable <tt class="docutils literal"><span class="pre">sel_events</span></tt> no longer
points to a table.  We can no longer make use of the <tt class="xref py py-meth docutils literal"><span class="pre">Table.col()</span></tt>
method, but we <em>can</em> access all pulseheights in the following way:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">sel_events</span><span class="p">[</span><span class="s">&#39;pulseheights&#39;</span><span class="p">]</span>
<span class="go">array([[173,   3, 407,   3],</span>
<span class="go">       [  1,   2, 313, 756],</span>
<span class="go">       [211,   2,   2, 268],</span>
<span class="go">       ...,</span>
<span class="go">       [328, 556, 255,  15],</span>
<span class="go">       [  3, 325, 309,   3],</span>
<span class="go">       [  2,   2, 271, 381]], dtype=int16)</span>
</pre></div>
</div>
<p>This notation is possible for arrays, but not for tables.  So, for tables,
use the <tt class="xref py py-meth docutils literal"><span class="pre">Table.col()</span></tt> method.  For arrays, use this special notation.</p>
</div>
<div class="section" id="the-sapphire-time-util-module">
<h3>2.2.4. The <a class="reference internal" href="time_util.html#module-sapphire.time_util" title="sapphire.time_util"><tt class="xref py py-mod docutils literal"><span class="pre">sapphire.time_util</span></tt></a> module<a class="headerlink" href="#the-sapphire-time-util-module" title="Permalink to this headline">¶</a></h3>
<p>SAPPHiRE includes a handy module: <a class="reference internal" href="time_util.html#module-sapphire.time_util" title="sapphire.time_util"><tt class="xref py py-mod docutils literal"><span class="pre">sapphire.time_util</span></tt></a>.  This saves
you from the hassle of converting timestamps and confusing local time and
GPS (or UTC) time.  It is important to realize that the HiSPARC station
uses a GPS clock, and thus saves all timestamps in GPS time, which is
certainly not local time!  You can look up <a class="reference external" href="http://en.wikipedia.org/wiki/Global_Positioning_System#Timekeeping">GPS time</a>,
but suffice it to say that it is <em>almost</em> equal to UTC time.  The
difference is the leap seconds introduced after 1980.  In January 2013,
GPS time is ahead of UTC by 16 seconds.  We will not reference UTC or
local time, but instead always reference GPS time!</p>
<p>While you tell SAPPHiRE to download data using year, month, day, hour,
minutes, seconds notation, the events table contains timestamps.  It is
often hard to convert between the two.  For example, the correct
conversion between a GPS date/time and a GPS timestamp is given by:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">calendar</span><span class="o">.</span><span class="n">timegm</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">utctimetuple</span><span class="p">())</span>
<span class="go">1354320000</span>
</pre></div>
</div>
<p>Which is, at best, cumbersome.  It is easy, however, to screw up and
inadvertently convert to local time.  For your benefit, we have included
the <a class="reference internal" href="time_util.html#sapphire.time_util.GPSTime" title="sapphire.time_util.GPSTime"><tt class="xref py py-class docutils literal"><span class="pre">sapphire.time_util.GPSTime</span></tt></a> class.  You instantiate the class
by giving it a GPS time to work with.  It can either be in date/time
notation, or as a timestamp.  For example, the exact same result is
obtained by these two lines of code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sapphire.time_util</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sapphire</span><span class="o">.</span><span class="n">time_util</span><span class="o">.</span><span class="n">GPSTime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">&lt;sapphire.time_util.GPSTime instance at 0x10b8021b8&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sapphire</span><span class="o">.</span><span class="n">time_util</span><span class="o">.</span><span class="n">GPSTime</span><span class="p">(</span><span class="mi">1354320000</span><span class="p">)</span>
<span class="go">&lt;sapphire.time_util.GPSTime instance at 0x10b802128&gt;</span>
</pre></div>
</div>
<p>If you store the instance, you can then call several methods to convert
the date/time to whatever you require:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">gpstime</span> <span class="o">=</span> <span class="n">sapphire</span><span class="o">.</span><span class="n">time_util</span><span class="o">.</span><span class="n">GPSTime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gpstime</span><span class="o">.</span><span class="n">datetime</span><span class="p">()</span>
<span class="go">datetime.datetime(2012, 12, 1, 0, 0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gpstime</span><span class="o">.</span><span class="n">description</span><span class="p">()</span>
<span class="go">&#39;Sat Dec  1 00:00:00 2012&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gpstime</span><span class="o">.</span><span class="n">gpstimestamp</span><span class="p">()</span>
<span class="go">1354320000</span>
</pre></div>
</div>
<p>Or, indeed:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">gpstime</span> <span class="o">=</span> <span class="n">sapphire</span><span class="o">.</span><span class="n">time_util</span><span class="o">.</span><span class="n">GPSTime</span><span class="p">(</span><span class="mi">1354320000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gpstime</span><span class="o">.</span><span class="n">datetime</span><span class="p">()</span>
<span class="go">datetime.datetime(2012, 12, 1, 0, 0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gpstime</span><span class="o">.</span><span class="n">description</span><span class="p">()</span>
<span class="go">&#39;Sat Dec  1 00:00:00 2012&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gpstime</span><span class="o">.</span><span class="n">gpstimestamp</span><span class="p">()</span>
<span class="go">1354320000</span>
</pre></div>
</div>
<p>It is now easy to select events occuring between 12:00 and 13:00 hours GPS
time on December 2, 2012:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t0</span> <span class="o">=</span> <span class="n">sapphire</span><span class="o">.</span><span class="n">time_util</span><span class="o">.</span><span class="n">GPSTime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">gpstimestamp</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="o">=</span> <span class="n">sapphire</span><span class="o">.</span><span class="n">time_util</span><span class="o">.</span><span class="n">GPSTime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">gpstimestamp</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span>
<span class="go">(1354449600, 1354453200)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sel_events</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">readWhere</span><span class="p">(</span><span class="s">&#39;(t0 &lt;= timestamp) &amp; (timestamp &lt; t1)&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">sel_events</span><span class="p">)</span>
<span class="go">2817</span>
</pre></div>
</div>
<p>And when did the tenth event occur?  Well:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">sel_events</span><span class="p">[</span><span class="mi">9</span><span class="p">][</span><span class="s">&#39;timestamp&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">1354449620</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sapphire</span><span class="o">.</span><span class="n">time_util</span><span class="o">.</span><span class="n">GPSTime</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">description</span><span class="p">()</span>
<span class="go">&#39;Sun Dec  2 12:00:20 2012&#39;</span>
</pre></div>
</div>
<p>To shorten the typing somewhat, remember that in Python you can import
classes from modules into your own namespace:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sapphire.time_util</span> <span class="kn">import</span> <span class="n">GPSTime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">GPSTime</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">description</span><span class="p">()</span>
<span class="go">&#39;Sun Dec  2 12:00:20 2012&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="plotting-data">
<h3>2.2.5. Plotting data<a class="headerlink" href="#plotting-data" title="Permalink to this headline">¶</a></h3>
<p>Now that we can access the data, we want to visualize it.  Plotting data
is a great way to do that.  And of course, the venerable histogram is
still very useful to condense thousands of events into one display.  Pylab
contains an easy function to do just that: <tt class="xref py py-func docutils literal"><span class="pre">hist()</span></tt>.  Let&#8217;s try to
recreate a few graphs as seen on the HiSPARC <a class="reference external" href="http://data.hisparc.nl/show/stations/501/2012/12/1/">data display</a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ph</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s">&#39;pulseheights&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hist</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
<span class="go">([array([114794,  17565,   3062,   1009,    502,    285,    170,     86,</span>
<span class="go">           72,     55]), array([112813,  19028,   3339,   1246,    540,    295,    163,    100,</span>
<span class="go">           66,     10]), array([109162,  21833,   4246,   1345,    579,    290,    113,     32,</span>
<span class="go">            0,      0]), array([109996,  21283,   4028,   1285,    581,    251,    133,     43,</span>
<span class="go">            0,      0])], array([  1.00000000e+00,   3.91100000e+02,   7.81200000e+02,</span>
<span class="go">         1.17130000e+03,   1.56140000e+03,   1.95150000e+03,</span>
<span class="go">         2.34160000e+03,   2.73170000e+03,   3.12180000e+03,</span>
<span class="go">         3.51190000e+03,   3.90200000e+03]), &lt;a list of 4 Lists of Patches objects&gt;)</span>
</pre></div>
</div>
<img alt="_images/tutorial-hist-simple.png" src="_images/tutorial-hist-simple.png" style="width: 500px;" />
<p>This will not do.  Firstly, data from the four detectors is pictured as
four side-by-side colored bars.  Secondly, the number of bins is very low;
it is only ten.  Thirdly, the data range continues up to very high values
with hardly any events.</p>
<p>To fix this, we&#8217;ll make use of several arguments that can be passed to the
<tt class="xref py py-func docutils literal"><span class="pre">hist()</span></tt> function.  We&#8217;ll also make use of some NumPy (<a class="reference external" href="http://docs.scipy.org/doc/numpy/user/">documentation</a>) functionality.  For Pylab
documentation, see the <a class="reference external" href="http://matplotlib.org">Matplotlib site</a>
(<a class="reference external" href="http://matplotlib.org/1.2.0/api/pyplot_summary.html">function reference</a>).  Try this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bins</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hist</span><span class="p">(</span><span class="n">ph</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Pulseheight [ADC]&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Counts&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Pulseheight histogram (log scale)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="xref py py-func docutils literal"><span class="pre">arange()</span></tt> function returns an array with range from 0 to 2000 in
steps of 20.  It is necessary to say 2001 (or 2002, 2000.1 or whatever)
and not 2000, if you want the range to be inclusive.  The <tt class="xref py py-func docutils literal"><span class="pre">hist()</span></tt>
function will then plot a <em>stepped</em> histogram with a log scale.  Finally,
we add some labels and a title.  This is the result:</p>
<img alt="_images/tutorial-hist-better.png" src="_images/tutorial-hist-better.png" style="width: 500px;" />
<p>In this plot, the gamma and charged particle part of the spectrum are easy
to distinguish.  The cut at 123 ADC is due to the trigger.  The bump at
approximately 300 ADC is the so-called MIP (minimum ionizing particle)
peak.  For an explanation of this plot and the features of the pulseheight
histogram, see <a class="reference external" href="http://www.nikhef.nl/pub/services/biblio/theses_pdf/thesis_D_Fokkema.pdf">David&#8217;s thesis</a>,
page 44–45, and 49–51.</p>
</div>
</div>
<div class="section" id="searching-for-coincidences">
<h2>2.3. Searching for coincidences<a class="headerlink" href="#searching-for-coincidences" title="Permalink to this headline">¶</a></h2>
<p>If you work with HiSPARC data, invariably you&#8217;ll be interested in
<em>coincidences</em> between HiSPARC stations.  That is, are there showers
which have been observed by multiple stations?  To find out, we&#8217;ll make
use of the <a class="reference internal" href="coincidences.html#module-sapphire.analysis.coincidences" title="sapphire.analysis.coincidences"><tt class="xref py py-mod docutils literal"><span class="pre">sapphire.analysis.coincidences</span></tt></a> module.</p>
<div class="section" id="performing-the-search">
<h3>2.3.1. Performing the search<a class="headerlink" href="#performing-the-search" title="Permalink to this headline">¶</a></h3>
<p>Consider the following script, which you can hopefully understand by now
(note that the prompt (&gt;&gt;&gt;) is absent, since this is a <em>script</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">import</span> <span class="nn">tables</span>

<span class="kn">from</span> <span class="nn">sapphire.publicdb</span> <span class="kn">import</span> <span class="n">download_data</span>
<span class="kn">from</span> <span class="nn">sapphire.analysis</span> <span class="kn">import</span> <span class="n">coincidences</span>


<span class="n">STATIONS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">501</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">506</span><span class="p">]</span>
<span class="n">START</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">END</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">station_groups</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/s</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">STATIONS</span><span class="p">]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">openFile</span><span class="p">(</span><span class="s">&#39;data.h5&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">station</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">STATIONS</span><span class="p">,</span> <span class="n">station_groups</span><span class="p">):</span>
        <span class="n">download_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">START</span><span class="p">,</span> <span class="n">END</span><span class="p">)</span>
</pre></div>
</div>
<p>At this point, we have downloaded data for three stations.  Note that we
didn&#8217;t specify <tt class="docutils literal"><span class="pre">get_blobs=True</span></tt> in the
<a class="reference internal" href="publicdb.html#sapphire.publicdb.download_data" title="sapphire.publicdb.download_data"><tt class="xref py py-func docutils literal"><span class="pre">sapphire.publicdb.download_data()</span></tt></a> function.  Thus, we have no traces
and the download is quick.  Let&#8217;s see what the datafile now contains:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">data</span>
<span class="go">data.h5 (File) &#39;&#39;</span>
<span class="go">Last modif.: &#39;Mon Jan 14 17:34:39 2013&#39;</span>
<span class="go">Object Tree:</span>
<span class="go">/ (RootGroup) &#39;&#39;</span>
<span class="go">/s501 (Group) &#39;Data group&#39;</span>
<span class="go">/s501/events (Table(70643,)) &#39;HiSPARC coincidences table&#39;</span>
<span class="go">/s501/weather (Table(25199,)) &#39;HiSPARC weather data&#39;</span>
<span class="go">/s503 (Group) &#39;Data group&#39;</span>
<span class="go">/s503/events (Table(34937,)) &#39;HiSPARC coincidences table&#39;</span>
<span class="go">/s506 (Group) &#39;Data group&#39;</span>
<span class="go">/s506/events (Table(68365,)) &#39;HiSPARC coincidences table&#39;</span>
</pre></div>
</div>
<p>It contains three groups, one for each station.  To search for
coincidences between these stations, we first initialize the
<a class="reference internal" href="coincidences.html#sapphire.analysis.coincidences.Coincidences" title="sapphire.analysis.coincidences.Coincidences"><tt class="xref py py-class docutils literal"><span class="pre">sapphire.analysis.coincidences.Coincidences</span></tt></a> class like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">coincidences</span> <span class="o">=</span> <span class="n">coincidences</span><span class="o">.</span><span class="n">Coincidences</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&#39;/coincidences&#39;</span><span class="p">,</span>
<span class="gp">... </span>                                         <span class="n">station_groups</span><span class="p">)</span>
</pre></div>
</div>
<p>From the documentation (click on the class above the example to go to the
documentation) it is clear that we have to specify the datafile
(<tt class="docutils literal"><span class="pre">data</span></tt>), the destination group (<tt class="docutils literal"><span class="pre">/coincidences</span></tt>) and the groups
containing the station data (<tt class="docutils literal"><span class="pre">station_groups</span></tt>).  Once that&#8217;s done, there
is an easy way to search for coincidences, process the events making up
the coincidences, and store them in the destination group:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">coincidences</span><span class="o">.</span><span class="n">search_and_store_coincidences</span><span class="p">()</span>
</pre></div>
</div>
<p>If you want to tweak the process using non-default parameters, see the
module documentation (<a class="reference internal" href="coincidences.html#module-sapphire.analysis.coincidences" title="sapphire.analysis.coincidences"><tt class="xref py py-mod docutils literal"><span class="pre">sapphire.analysis.coincidences</span></tt></a>).  For now,
let us turn to the results:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">data</span>
<span class="go">data.h5 (File) &#39;&#39;</span>
<span class="go">Last modif.: &#39;Mon Jan 14 17:46:23 2013&#39;</span>
<span class="go">Object Tree:</span>
<span class="go">/ (RootGroup) &#39;&#39;</span>
<span class="go">/coincidences (Group) &#39;&#39;</span>
<span class="go">/coincidences/_src_c_index (VLArray(4976,)) &#39;&#39;</span>
<span class="go">/coincidences/_src_timestamps (Array(173945, 3)) &#39;&#39;</span>
<span class="go">/coincidences/c_index (VLArray(4976,)) &#39;&#39;</span>
<span class="go">/coincidences/coincidences (Table(4976,)) &#39;&#39;</span>
<span class="go">/coincidences/observables (Table(10479,)) &#39;&#39;</span>
<span class="go">/s501 (Group) &#39;Data group&#39;</span>
<span class="go">/s501/_events (Table(70643,)) &#39;HiSPARC coincidences table&#39;</span>
<span class="go">/s501/events (Table(70643,)) &#39;&#39;</span>
<span class="go">/s501/weather (Table(25199,)) &#39;HiSPARC weather data&#39;</span>
<span class="go">/s503 (Group) &#39;Data group&#39;</span>
<span class="go">/s503/_events (Table(34937,)) &#39;HiSPARC coincidences table&#39;</span>
<span class="go">/s503/events (Table(34937,)) &#39;&#39;</span>
<span class="go">/s506 (Group) &#39;Data group&#39;</span>
<span class="go">/s506/_events (Table(68365,)) &#39;HiSPARC coincidences table&#39;</span>
<span class="go">/s506/events (Table(68365,)) &#39;&#39;</span>
</pre></div>
</div>
<p>The new addition is the <tt class="docutils literal"><span class="pre">/coincidences</span></tt> group.  It contains two more or
less private members: <tt class="docutils literal"><span class="pre">_src_c_index</span></tt> and <tt class="docutils literal"><span class="pre">_src_timestamps</span></tt>.  We won&#8217;t
cover them here.  The public tables are <tt class="docutils literal"><span class="pre">c_index</span></tt>, <tt class="docutils literal"><span class="pre">coincidences</span></tt> and
<tt class="docutils literal"><span class="pre">observables</span></tt>.  Information about the coincidences is stored in the
<tt class="docutils literal"><span class="pre">coincidences</span></tt> table.  Let&#8217;s look at the columns:</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">column</th>
<th class="head">description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>id</td>
<td>an index number identifying the coincidence</td>
</tr>
<tr class="row-odd"><td>N</td>
<td>the number of stations taking part in the coincidence</td>
</tr>
<tr class="row-even"><td>timestamp</td>
<td>the unix timestamp</td>
</tr>
<tr class="row-odd"><td>nanoseconds</td>
<td>the nanosecond part of the timestamp</td>
</tr>
<tr class="row-even"><td>ext_timestamp</td>
<td>the timestamp in nanoseconds</td>
</tr>
<tr class="row-odd"><td>r</td>
<td><em>compatibility reasons</em></td>
</tr>
<tr class="row-even"><td>phi</td>
<td><em>compatibility reasons</em></td>
</tr>
<tr class="row-odd"><td>x</td>
<td><em>compatibility reasons</em></td>
</tr>
<tr class="row-even"><td>y</td>
<td><em>compatibility reasons</em></td>
</tr>
<tr class="row-odd"><td>shower_size</td>
<td><em>compatibility reasons</em></td>
</tr>
<tr class="row-even"><td>shower_theta</td>
<td><em>compatibility reasons</em></td>
</tr>
<tr class="row-odd"><td>shower_phi</td>
<td><em>compatibility reasons</em></td>
</tr>
</tbody>
</table>
<p>The columns included for compatibility reasons are used by the event
simulation code.  In that case, the <tt class="docutils literal"><span class="pre">r</span></tt>, <tt class="docutils literal"><span class="pre">phi</span></tt> describe the location
of the shower core in polar coordinates.  Similarly, the <tt class="docutils literal"><span class="pre">x</span></tt>, <tt class="docutils literal"><span class="pre">y</span></tt>
columns give the position in cartesian coordinates.  Furthermore, the
<tt class="docutils literal"><span class="pre">shower_size</span></tt> gives the so-called <em>shower size</em>, and <tt class="docutils literal"><span class="pre">shower_theta</span></tt>
and <tt class="docutils literal"><span class="pre">shower_phi</span></tt> contain the direction of the (simulated) shower.  These
are not known for certain when working with HiSPARC data, but are
included nonetheless.  These columns are all set to 0.0.</p>
<p>The <tt class="docutils literal"><span class="pre">c_index</span></tt> array is used as an index to look up the individual events
making up a coincidence.  The fifth coincidence is accessed by:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">coincidences</span><span class="o">.</span><span class="n">coincidences</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
<p>Remember, the indexes are zero-based.  The coincidence id is also 4:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">coincidences</span><span class="o">.</span><span class="n">coincidences</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
<span class="go">4</span>
</pre></div>
</div>
<p>and the number of stations participating is 2:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">coincidences</span><span class="o">.</span><span class="n">coincidences</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s">&#39;N&#39;</span><span class="p">]</span>
<span class="go">2</span>
</pre></div>
</div>
<p>To lookup the indexes of the events taking part in this coincidence,
access the <tt class="docutils literal"><span class="pre">c_index</span></tt> array using the same id:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">coincidences</span><span class="o">.</span><span class="n">c_index</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="go">array([8, 9], dtype=uint32)</span>
</pre></div>
</div>
<p>That is, event ids 8 and 9 are part of this coincidence.  The event
observables are then stored in the <tt class="docutils literal"><span class="pre">observables</span></tt> table, and can be
accessed using these ids:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">coincidences</span><span class="o">.</span><span class="n">observables</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="go">(2, 0.0, 1356998421116183027L, 8L, 0.6368421316146851,</span>
<span class="go">0.005263158120214939, 0.005263158120214939, 1.0394736528396606,</span>
<span class="go">116183027L, 0.0, 0.0, 2, -1.0, -1.0, -1.0, -1.0, 1356998421, 0.0, 0.0)</span>
</pre></div>
</div>
<p>The columns in this table are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">column</th>
<th class="head">description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>id</td>
<td>an index number identifying the event</td>
</tr>
<tr class="row-odd"><td>station_id</td>
<td>an index number identifying the station</td>
</tr>
<tr class="row-even"><td>N</td>
<td>the number of detectors with particles</td>
</tr>
<tr class="row-odd"><td>timestamp</td>
<td>the unix timestamp</td>
</tr>
<tr class="row-even"><td>nanoseconds</td>
<td>the nanosecond part of the timestamp</td>
</tr>
<tr class="row-odd"><td>ext_timestamp</td>
<td>the timestamp in nanoseconds</td>
</tr>
<tr class="row-even"><td>n1</td>
<td>the number of particles in detector 1</td>
</tr>
<tr class="row-odd"><td>n2</td>
<td>the number of particles in detector 2</td>
</tr>
<tr class="row-even"><td>n3</td>
<td>the number of particles in detector 3</td>
</tr>
<tr class="row-odd"><td>n4</td>
<td>the number of particles in detector 4</td>
</tr>
<tr class="row-even"><td>t1</td>
<td>the particle arrival time in detector 1</td>
</tr>
<tr class="row-odd"><td>t2</td>
<td>the particle arrival time in detector 2</td>
</tr>
<tr class="row-even"><td>t3</td>
<td>the particle arrival time in detector 3</td>
</tr>
<tr class="row-odd"><td>t4</td>
<td>the particle arrival time in detector 4</td>
</tr>
<tr class="row-even"><td>r</td>
<td><em>compatibility reasons</em></td>
</tr>
<tr class="row-odd"><td>phi</td>
<td><em>compatibility reasons</em></td>
</tr>
<tr class="row-even"><td>x</td>
<td><em>compatibility reasons</em></td>
</tr>
<tr class="row-odd"><td>y</td>
<td><em>compatibility reasons</em></td>
</tr>
<tr class="row-even"><td>alpha</td>
<td><em>compatibility reasons</em></td>
</tr>
</tbody>
</table>
<p>The columns included for compatibility reasons are again used by the event
simulation code.  In that case, the <tt class="docutils literal"><span class="pre">r</span></tt>, <tt class="docutils literal"><span class="pre">phi</span></tt>, <tt class="docutils literal"><span class="pre">x</span></tt> and <tt class="docutils literal"><span class="pre">y</span></tt>
coordinates refer to the position of the <em>station</em>, not the shower.  In
some types of simulation, the position of the station is changed from
event to event.  The <tt class="docutils literal"><span class="pre">alpha</span></tt> column refers to the <em>orientation</em> of the
station in those cases.</p>
<p>The station id is an index into the <tt class="docutils literal"><span class="pre">station_groups</span></tt> list which was used
when searching for coincidences.  So, an id of 2 refers to <tt class="docutils literal"><span class="pre">/s506</span></tt>.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="event-id" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Unique in this table.  When data is downloaded for analysis and
combined with other data into one table, the <tt class="docutils literal"><span class="pre">event_id</span></tt> will be
different.  To uniquely define an event, use a station number /
<tt class="docutils literal"><span class="pre">ext_timestamp</span></tt> combination.</td></tr>
</tbody>
</table>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2. Tutorial</a><ul>
<li><a class="reference internal" href="#first-steps">2.1. First steps</a></li>
<li><a class="reference internal" href="#downloading-and-accessing-hisparc-data">2.2. Downloading and accessing HiSPARC data</a><ul>
<li><a class="reference internal" href="#downloading-data">2.2.1. Downloading data</a></li>
<li><a class="reference internal" href="#looking-around">2.2.2. Looking around</a></li>
<li><a class="reference internal" href="#accessing-the-data">2.2.3. Accessing the data</a></li>
<li><a class="reference internal" href="#the-sapphire-time-util-module">2.2.4. The <tt class="docutils literal"><span class="pre">sapphire.time_util</span></tt> module</a></li>
<li><a class="reference internal" href="#plotting-data">2.2.5. Plotting data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#searching-for-coincidences">2.3. Searching for coincidences</a><ul>
<li><a class="reference internal" href="#performing-the-search">2.3.1. Performing the search</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installation.html"
                        title="previous chapter">1. Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="sapphire.html"
                        title="next chapter">3. SAPPHiRE Reference</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="sapphire.html" title="3. SAPPHiRE Reference"
             >next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="1. Installation"
             >previous</a> |</li>
        <li><a href="index.html">SAPPHiRE 0.9 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, David Fokkema.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>